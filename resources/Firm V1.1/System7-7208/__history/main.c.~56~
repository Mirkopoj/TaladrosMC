#include <main.h>

int16 dc1, dc2;
int16 C1, C2;

void main()
{
   setup_adc(ADC_CLOCK_INTERNAL);
   setup_adc_ports(sAN5 | sAN6 | VSS_VDD);      //AN5 es C1; AN6 es C2
      
   setup_timer_2(T2_DIV_BY_16,255,1);      //2,0 ms overflow, 2,0 ms interrupt
   setup_pwm1(PWM_ENABLED | PWM_ACTIVE_HIGH | PWM_OUTPUT);
   
   set_pwm1_duty(102);
   delay_ms(2000);
   set_pwm1_duty(52);
   delay_ms(2000);
   set_pwm1_duty(77);
   delay_ms(500);
   
   while(TRUE)
   {
      set_adc_channel(5);
      C1 = read_adc();
      delay_ms(10);
      set_adc_channel(6);
      C2 = read_adc();
      delay_ms(10);
      
      if(C1>535)
      {
         dc1 = (C1/2) - 213;
         if (dc1<52) {dc1=52;}
         if (dc1>102) {dc1=102;}
         set_pwm1_duty(dc1);
      }
      else if(C2>535)
      {
         dc2 = (C2/2) - 188;
         if (dc2<52) {dc2=52;}
         if (dc2>102) {dc2=102;}
         set_pwm1_duty(dc2);
      }
      else
      {
         dc1 = 77;
         dc2 = 77;
      }
   }
}
